# -----------------------------------------------------------------
# Docker Compose for litellm (Portainer friendly)
# -----------------------------------------------------------------
# The original `db` service is commented out because you use Supabase.
# Keep it here for reference / quick re‑enable during local testing.
# -----------------------------------------------------------------

services:
  # Litellm gateway (proxy)
  skypiea-gateway:
    container_name: skypiea-gateway
    build:
      context: .
      args:
        target: runtime
    image: ghcr.io/itsreiji/skypiea-gateway:latest
    volumes:
      - ${PWD}/proxy_server_config.yaml:/app/proxy_server_config.yaml
    command:
      - "--config=/app/proxy_server_config.yaml"
    environment:
      - LITELLM_MASTER_KEY=${LITELLM_MASTER_KEY}
      - LITELLM_SALT_KEY=${LITELLM_SALT_KEY}
      - DATABASE_URL=${DATABASE_URL}
      - STORE_MODEL_IN_DB=${STORE_MODEL_IN_DB}
      - UI_USERNAME=${UI_USERNAME}
      - UI_PASSWORD=${UI_PASSWORD}
    restart: unless-stopped

  # Prometheus monitoring (optional)
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - prometheus_data:/prometheus
    restart: unless-stopped

# -----------------------------------------------------------------
# Disabled internal Postgres (use Supabase instead)
# -----------------------------------------------------------------
#  db:
#    image: postgres:18
#    restart: always
#    container_name: litellm_db
#    environment:
#      POSTGRES_DB: litellm
#      POSTGRES_USER: llmproxy
#      POSTGRES_PASSWORD: dbpassword9090
#    ports:
#      - "5432:5432"
#    volumes:
#      - postgres_data:/var/lib/postgresql/data # Persists Postgres data across container restarts
#    healthcheck:
#      test: ["CMD-SHELL", "pg_isready -d litellm -U llmproxy"]
#      interval: 1s
#      timeout: 5s
#      retries: 10

volumes:
  # Volume kept for compatibility – not used when you run Supabase externally
  postgres_data:
    name: litellm_postgres_data
  prometheus_data:
    driver: local